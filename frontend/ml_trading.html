<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Trading System - StockApp</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/tos-theme.css">
    <link rel="stylesheet" href="css/heatmap-page.css">
    <style>
        .ml-system-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }
        .system-stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 15px 20px;
            border-radius: 8px;
            flex: 1;
            min-width: 150px;
        }
        .stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--text-primary);
        }
        .stat-value.positive { color: #10b981; }
        .stat-value.negative { color: #ef4444; }
        .ml-badge {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 8px;
        }

        /* Training Progress Tracker Styles */
        .training-progress-container {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .training-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .training-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.3em;
        }
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .progress-stat {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .progress-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .progress-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-primary);
        }
        .progress-value.countdown {
            color: #667eea;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .progress-bar-container {
            position: relative;
            width: 100%;
            height: 40px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: var(--text-primary);
            text-shadow: 0 0 4px rgba(0,0,0,0.3);
            z-index: 10;
        }
        .training-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .milestones-timeline {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .milestone {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .milestone:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        .milestone.completed {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        .milestone.current {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            animation: glow 2s ease-in-out infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.6); }
        }
        .milestone-icon {
            font-size: 2em;
            margin-right: 15px;
            min-width: 40px;
            text-align: center;
        }
        .milestone-content {
            flex: 1;
        }
        .milestone-title {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 1.1em;
            margin-bottom: 3px;
        }
        .milestone-date {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 3px;
        }
        .milestone-status {
            color: var(--text-secondary);
            font-size: 0.85em;
            font-style: italic;
        }
    </style>
</head>
<body class="tos-theme">
    <div class="heatmap-page-container">
        <!-- Header -->
        <div class="heatmap-header">
            <div class="heatmap-title">
                <h1>
                    ML Trading System
                    <span class="ml-system-badge">ML Pipeline</span>
                </h1>
                <p class="heatmap-subtitle">Zero-cost modular ML with ensemble learning</p>
            </div>
            <div class="heatmap-actions">
                <button class="tos-btn-primary" onclick="runMLScan()" id="scan-btn">
                    üîç Run Scan
                </button>
                <button class="tos-btn-primary" onclick="runFullCycle()" id="full-cycle-btn" title="Run complete cycle: Scan + Simulate + Learn + Retrain">
                    üöÄ Run Full Cycle
                </button>
                <button class="tos-btn-secondary" onclick="runLearnerOnly()" id="learner-btn" title="Run learner only (uses last scan results)">
                    ü§ñ Run Learner
                </button>
                <button class="tos-btn-secondary" onclick="checkAutomationStatus()" id="automation-status-btn" title="Check if daily automation is enabled">
                    ‚öôÔ∏è Status
                </button>
                <button class="tos-btn-primary" onclick="startAutomation()" id="automation-start-btn" title="Start daily automation (6 PM)">
                    ‚ñ∂Ô∏è Start Auto
                </button>
                <button class="tos-btn-secondary" onclick="stopAutomation()" id="automation-stop-btn" title="Stop daily automation">
                    ‚è∏Ô∏è Stop Auto
                </button>
                <button class="tos-btn-secondary" onclick="refreshSignals()">
                    <span id="refresh-icon">‚Üª</span> Refresh
                </button>
                <button class="tos-btn-secondary" onclick="showStats()">
                    üìä Stats
                </button>
                <button class="tos-btn-secondary" onclick="window.location.href='/ml-settings'" title="Create and manage ML model configurations">
                    ‚öôÔ∏è Model Settings
                </button>
                <button class="tos-btn-secondary" onclick="window.location.href='/'">
                    ‚Üê Back to Chart
                </button>
            </div>
        </div>

        <!-- System Stats (initially hidden) -->
        <div class="system-stats" id="system-stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">Total Trades</div>
                <div class="stat-value" id="stat-total-trades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Win Rate</div>
                <div class="stat-value" id="stat-win-rate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total P/L</div>
                <div class="stat-value" id="stat-total-pl">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Profit Factor</div>
                <div class="stat-value" id="stat-profit-factor">0.00</div>
            </div>
        </div>

        <!-- Training Progress Tracker -->
        <div class="training-progress-container" id="training-progress" style="display: none;">
            <div class="training-header">
                <h3>üéì ML Training Progress</h3>
                <button class="tos-btn-secondary" style="font-size: 0.85em; padding: 5px 12px;" onclick="toggleTrainingDetails()">
                    <span id="training-details-toggle">Show Details ‚ñº</span>
                </button>
            </div>

            <!-- Progress Summary -->
            <div class="progress-summary">
                <div class="progress-stat">
                    <div class="progress-label">Completed Trades</div>
                    <div class="progress-value" id="progress-trades">0 / 840</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-label">Current Level</div>
                    <div class="progress-value" id="progress-level">Untrained</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-label">Win Rate</div>
                    <div class="progress-value" id="progress-winrate">0%</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-label">Days Until Expert</div>
                    <div class="progress-value countdown" id="progress-countdown">43 days</div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                <div class="progress-text" id="progress-text">0% to Expert Level</div>
            </div>

            <!-- Milestone Timeline (collapsible) -->
            <div class="training-details" id="training-details" style="display: none;">
                <div class="milestones-timeline">
                    <div class="milestone" id="milestone-first-cycle">
                        <div class="milestone-icon">üöÄ</div>
                        <div class="milestone-content">
                            <div class="milestone-title">First Cycle</div>
                            <div class="milestone-date" id="date-first-cycle">Dec 20, 2025</div>
                            <div class="milestone-status">30 trades simulated</div>
                        </div>
                    </div>
                    <div class="milestone" id="milestone-first-closures">
                        <div class="milestone-icon">üìä</div>
                        <div class="milestone-content">
                            <div class="milestone-title">First Closures</div>
                            <div class="milestone-date" id="date-first-closures">Jan 3, 2026 (15 days)</div>
                            <div class="milestone-status">First 30 positions close</div>
                        </div>
                    </div>
                    <div class="milestone" id="milestone-first-training">
                        <div class="milestone-icon">üéì</div>
                        <div class="milestone-content">
                            <div class="milestone-title">First Training</div>
                            <div class="milestone-date" id="date-first-training">Jan 6, 2026 (18 days)</div>
                            <div class="milestone-status">100 trades ‚Üí Model trains!</div>
                        </div>
                    </div>
                    <div class="milestone" id="milestone-well-trained">
                        <div class="milestone-icon">üìà</div>
                        <div class="milestone-content">
                            <div class="milestone-title">Well Trained</div>
                            <div class="milestone-date" id="date-well-trained">Jan 17, 2026 (29 days)</div>
                            <div class="milestone-status">420 trades ‚Üí 63% win rate</div>
                        </div>
                    </div>
                    <div class="milestone" id="milestone-expert">
                        <div class="milestone-icon">üß†</div>
                        <div class="milestone-content">
                            <div class="milestone-title">Expert Level</div>
                            <div class="milestone-date" id="date-expert">Jan 31, 2026 (43 days)</div>
                            <div class="milestone-status">840 trades ‚Üí 70% win rate!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeframe Filter Tabs -->
        <div class="timeframe-tabs">
            <button class="timeframe-tab active" data-timeframe="all" onclick="switchTimeframe('all')">
                All Signals
            </button>
            <button class="timeframe-tab" data-timeframe="intraday" onclick="switchTimeframe('intraday')">
                Intraday
                <span class="tab-count" id="count-intraday">0</span>
            </button>
            <button class="timeframe-tab" data-timeframe="daily" onclick="switchTimeframe('daily')">
                Daily
                <span class="tab-count" id="count-daily">0</span>
            </button>
            <button class="timeframe-tab" data-timeframe="monthly" onclick="switchTimeframe('monthly')">
                Monthly
                <span class="tab-count" id="count-monthly">0</span>
            </button>
        </div>

        <!-- Heat Map Content Area -->
        <div class="heatmap-content">
            <!-- Intraday Section -->
            <div class="heatmap-section" id="section-intraday">
                <div class="section-header">
                    <h2>Intraday Signals <span class="ml-badge">ML</span></h2>
                    <p>High confidence (‚â•70%), high score (‚â•65) - Quick trades</p>
                </div>
                <div class="heatmap-grid" id="grid-intraday">
                    <!-- Signals will be rendered here -->
                </div>
            </div>

            <!-- Daily Section -->
            <div class="heatmap-section" id="section-daily">
                <div class="section-header">
                    <h2>Daily Signals <span class="ml-badge">ML</span></h2>
                    <p>Medium-high confidence (‚â•55%), good score (‚â•55) - Swing trades</p>
                </div>
                <div class="heatmap-grid" id="grid-daily">
                    <!-- Signals will be rendered here -->
                </div>
            </div>

            <!-- Monthly Section -->
            <div class="heatmap-section" id="section-monthly">
                <div class="section-header">
                    <h2>Monthly Signals <span class="ml-badge">ML</span></h2>
                    <p>Reasonable confidence (‚â•40%), score (‚â•45) - Position trades</p>
                </div>
                <div class="heatmap-grid" id="grid-monthly">
                    <!-- Signals will be rendered here -->
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="empty-state" style="display: none;">
                <div class="empty-icon">ü§ñ</div>
                <h3>No ML Signals Available</h3>
                <p>Run a scan to generate ML-powered trading signals.</p>
                <button class="tos-btn-primary" onclick="runMLScan()">Run ML Scan</button>
            </div>

            <!-- Loading State -->
            <div class="loading-state" id="loading-state">
                <div class="loading-spinner"></div>
                <p>Loading ML signals...</p>
            </div>
        </div>

        <!-- Metadata Footer -->
        <div class="heatmap-footer" id="heatmap-footer" style="display: none;">
            <div class="metadata-item">
                <strong>System:</strong> <span id="meta-system">ML Trading System</span>
            </div>
            <div class="metadata-item">
                <strong>Last Updated:</strong> <span id="meta-timestamp">-</span>
            </div>
            <div class="metadata-item">
                <strong>Total Signals:</strong> <span id="meta-total">0</span>
            </div>
            <div class="metadata-item">
                <strong>Model Status:</strong> <span id="meta-model">Untrained</span>
            </div>
        </div>
    </div>

    <script src="js/ml-trading-page.js"></script>
</body>
</html>
